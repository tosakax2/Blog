<script>
  document.querySelectorAll("pre code").forEach((block) => {
    const btn = document.createElement("button");
    btn.innerText = "Copy";
    btn.className =
      "absolute top-2 right-2 bg-gray-700 text-white text-xs px-2 py-1 rounded hover:bg-gray-600";

    const wrapper = document.createElement("div");
    wrapper.className = "relative group";
    block.parentNode.replaceWith(wrapper);
    wrapper.appendChild(block.parentNode);
    wrapper.appendChild(btn);

    btn.addEventListener("click", () => {
      navigator.clipboard.writeText(block.innerText).then(() => {
        btn.innerText = "Copied!";
        setTimeout(() => (btn.innerText = "Copy"), 1000);
      });
    });
  });
</script>

<script>
  window.scrambleTitle = function ({
    selector = "h1[data-scramble]",
    letters = "ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-",
    interval = 40,
    fixInterval = 130,
  } = {}) {
    const els = document.querySelectorAll(selector);

    els.forEach((el) => {
      const finalText = el.dataset.scrambleText || el.textContent;
      let display = Array.from(finalText);
      let fixed = Array(finalText.length).fill(false);
      let currentStep = 0;
      let scrambleTimer, fixTimer;

      // Start randomizing all unfixed letters
      scrambleTimer = setInterval(() => {
        for (let i = 0; i < finalText.length; i++) {
          if (!fixed[i] && finalText[i] !== " ") {
            display[i] = letters[Math.floor(Math.random() * letters.length)];
          } else {
            display[i] = finalText[i];
          }
        }
        el.textContent = display.join("");
      }, interval);

      // Fix left-to-right
      fixTimer = setInterval(() => {
        if (currentStep < finalText.length) {
          while (
            finalText[currentStep] === " " &&
            currentStep < finalText.length
          ) {
            fixed[currentStep] = true;
            currentStep++;
          }
          fixed[currentStep] = true;
          currentStep++;
        } else {
          clearInterval(scrambleTimer);
          clearInterval(fixTimer);
          el.textContent = finalText;
        }
      }, fixInterval);
    });
  };

  document.addEventListener("DOMContentLoaded", () => {
    window.scrambleTitle();
  });
</script>
